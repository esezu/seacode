<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ @video.name }} - 播放 - {{ @site_name }}</title>
    <link rel="stylesheet" href="{{ @BASEURL }}/public/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <h1 class="logo">
                    <a href="{{ @BASEURL }}/">{{ @site_name }}</a>
                </h1>
                <nav class="nav">
                    <a href="{{ @BASEURL }}/">首页</a>
                    <a href="{{ @BASEURL }}/detail/{{ @video.id }}">返回详情</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main player-page">
        <div class="container">
            <div class="breadcrumb">
                <a href="{{ @BASEURL }}/">首页</a> &gt;
                <a href="{{ @BASEURL }}/type/{{ @video.tid }}">{{ @video.type }}</a> &gt;
                <a href="{{ @BASEURL }}/detail/{{ @video.id }}">{{ @video.name }}</a> &gt;
                <span>播放</span>
            </div>

            <div class="player-container">
                <h1 class="player-title">{{ @video.name }} - {{ @video.episodes[@current_episode - 1].name }}</h1>
                <div class="player-wrapper">
                    <iframe
                        id="player"
                        src="{{ @player_url }}"
                        class="player-iframe"
                        allowfullscreen
                        allow="autoplay; encrypted-media"
                        frameborder="0"
                        scrolling="no">
                    </iframe>
                </div>
            </div>

            <div class="episodes-section">
                <h2 class="section-title">选集播放</h2>
                <div class="episodes-grid">
                    <repeat group="{{ @video.episodes }}" key="{{ @key }}" value="{{ @episode }}">
                        <a href="{{ @BASEURL }}/play/{{ @video.id }}?url={{ @episode.url }}&episode={{ @key + 1 }}"
                           class="episode-btn {{ @key + 1 == @current_episode ? 'active' : '' }}">
                            {{ @episode.name }}
                        </a>
                    </repeat>
                </div>
            </div>

            <div class="video-info-summary">
                <h2 class="section-title">视频信息</h2>
                <div class="info-grid">
                    <div class="info-row">
                        <span class="info-label">名称:</span>
                        <span class="info-value">{{ @video.name }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">类型:</span>
                        <span class="info-value">{{ @video.type }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">导演:</span>
                        <span class="info-value">{{ @video.director }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">主演:</span>
                        <span class="info-value">{{ @video.actor }}</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 {{ @site_name }}. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // 记录播放历史
        document.addEventListener('DOMContentLoaded', function() {
            const currentEpisode = {{ @current_episode }};
            const videoId = '{{ @video.id }}';
            const videoName = '{{ @video.name }}';
            const episodeName = '{{ @video.episodes[@current_episode - 1].name }}';

            // 存储播放历史
            const history = JSON.parse(localStorage.getItem('playHistory') || '{}');
            history[videoId] = {
                name: videoName,
                episode: currentEpisode,
                episodeName: episodeName,
                url: window.location.href,
                timestamp: Date.now()
            };
            localStorage.setItem('playHistory', JSON.stringify(history));
        });
    </script>
</body>
</html>
